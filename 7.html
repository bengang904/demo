<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>猫咪检测</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      color: white;
      font-family: sans-serif;
    }
    #wrapper {
      position: relative;
    }
    video, canvas {
      width: 640px;
      height: 480px;
      border-radius: 8px;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>

<div id="wrapper">
  <video id="video" autoplay muted playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<!-- 加载 TensorFlow.js 和 COCO-SSD 模型 -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>

<script>
  async function setupCamera() {
    const video = document.getElementById("video");
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    return new Promise(resolve => {
      video.onloadedmetadata = () => resolve(video);
    });
  }

  async function detectCat() {
    const video = await setupCamera();
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const model = await cocoSsd.load();

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    async function detectFrame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const predictions = await model.detect(video);

      predictions.forEach(pred => {
        if (pred.class === "cat" && pred.score > 0.5) { // 提高置信度要求
          const [x, y, width, height] = pred.bbox;

          // 画边框
          ctx.strokeStyle = "#00FF00"
          ctx.lineWidth = 3;
          ctx.strokeRect(x, y, width, height);

          // 在框中心写字
          const label = `猫咪： ${(pred.score * 100).toFixed(1)}%`;
          ctx.font = "18px sans-serif";
          ctx.fillStyle = "#00FF00"
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(label, x + width / 2, y + height / 2);
        }
      });

      requestAnimationFrame(detectFrame); // 实时更新
    }

    detectFrame();
  }

  detectCat();
</script>

</body>
</html>
