<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>环境光传感器演示</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 50px;
      background: #f9f9f9;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }
    #lux {
      font-size: 48px;
      color: #333;
    }
    #status {
      margin-top: 20px;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>当前光照强度</h1>
  <div id="lux">读取中...</div>
  <div id="status">正在检测浏览器支持...</div>

  <script>
    const luxElement = document.getElementById('lux');
    const statusElement = document.getElementById('status');

    async function initAmbientLightSensor() {
      if (!('AmbientLightSensor' in window)) {
        luxElement.textContent = '不支持';
        statusElement.textContent = '当前浏览器不支持 Ambient Light Sensor API';
        return;
      }

      try {
        const permissionStatus = await navigator.permissions.query({ name: 'ambient-light-sensor' });

        if (permissionStatus.state === 'denied') {
          luxElement.textContent = '权限被拒绝';
          statusElement.textContent = '请在浏览器设置中启用光照传感器权限';
          return;
        }

        const sensor = new AmbientLightSensor();

        sensor.addEventListener('reading', () => {
          luxElement.textContent = `${sensor.illuminance.toFixed(2)} lux`;
          statusElement.textContent = '读取成功 ✔';
        });

        sensor.addEventListener('error', event => {
          luxElement.textContent = '读取失败';
          statusElement.textContent = `错误：${event.error.name} - ${event.error.message || '未知错误'}`;
        });

        sensor.start();
        statusElement.textContent = '传感器启动中...';
      } catch (err) {
        luxElement.textContent = '启动失败';
        statusElement.textContent = `异常：${err.message}`;
      }
    }

    initAmbientLightSensor();
  </script>
</body>
</html>
