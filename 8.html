<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>手电筒控制</title>
  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      background-color: #f4f4f4;
      text-align: center;
      padding: 100px 20px;
    }

    h1 {
      font-size: 2em;
      color: #333;
    }

    button {
      font-size: 1.2em;
      padding: 12px 30px;
      margin-top: 20px;
      border: none;
      border-radius: 12px;
      background-color: #007BFF;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #0056b3;
    }

    #status {
      margin-top: 20px;
      color: #555;
    }
  </style>
</head>
<body>

  <h1>手机手电筒控制</h1>
  <p>点击按钮打开/关闭闪光灯（仅支持部分安卓设备）</p>

  <button onclick="toggleFlashlight()">切换手电筒</button>
  <div id="status">等待操作…</div>

  <script>
    let stream;
    let torchOn = false;
    let track;

    async function toggleFlashlight() {
      const status = document.getElementById('status');

      try {
        if (!stream) {
          stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
          track = stream.getVideoTracks()[0];
        }

        const capabilities = track.getCapabilities();
        if (!capabilities.torch) {
          status.textContent = "此设备不支持闪光灯控制。";
          return;
        }

        torchOn = !torchOn;
        await track.applyConstraints({
          advanced: [{ torch: torchOn }]
        });

        status.textContent = torchOn ? "手电筒已开启。" : "手电筒已关闭。";

      } catch (err) {
        console.error(err);
        status.textContent = "操作失败：" + err.message;
      }
    }

    window.onbeforeunload = () => {
      if (track) track.stop();
    };
  </script>

</body>
</html>
