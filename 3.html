<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>通行密钥解锁页面</title>
</head>
<body>
<button id="btn">通行密钥解锁</button>
<p id="status"></p>

<script>
const statusEl = document.getElementById('status');
const btn = document.getElementById('btn');

btn.addEventListener('click', async () => {
  statusEl.textContent = '正在请求认证...';

  if (!window.PublicKeyCredential) {
    statusEl.textContent = '当前浏览器不支持WebAuthn';
    return;
  }

  try {
    // 生成一个认证请求（示例数据，生产环境需要后端生成Challenge）
    const publicKey = {
      challenge: new Uint8Array(32),
      timeout: 60000,
      userVerification: 'required',  // 强制生物识别验证
    };

    // 调用浏览器指纹（生物）认证
    const credential = await navigator.credentials.get({ publicKey });

    if (credential) {
      statusEl.textContent = '认证成功！';
      console.log('认证信息:', credential);
    } else {
      statusEl.textContent = '认证失败或取消';
    }
  } catch (err) {
    statusEl.textContent = '认证异常: ' + err.message;
  }
});
</script>
</body>
</html>
